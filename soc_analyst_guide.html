<!-- ********************************************************************** -->
<!--                                                                        -->
<!--  soc_analyst_guide.html                            TTTTTTTT SSSSSSS II -->
<!--                                                       TT    SS      II -->
<!--  By: st93642@students.tsi.lv                          TT    SSSSSSS II -->
<!--                                                       TT         SS II -->
<!--  Created: Jan 26 2026 21:06 st93642                   TT    SSSSSSS II -->
<!--  Updated: Jan 27 2026 21:06 st93642                                    -->
<!--                                                                        -->
<!--   Transport and Telecommunication Institute - Riga, Latvia             -->
<!--                       https://tsi.lv                                   -->
<!-- ********************************************************************** -->


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOC Analyst Guide - SIEM and Log Analysis Cheatsheet</title>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --success-color: #2ecc71;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --text-color: #333;
            --text-light: #fff;
            --code-bg: #282c34;
            --code-text: #abb2bf;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, var(--dark-color) 0%, var(--secondary-color) 100%);
            color: var(--text-light);
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .layout {
            display: flex;
            min-height: 100%;
        }

        .sidebar-toggle {
            display: none;
            background: var(--primary-color);
            color: var(--text-light);
            border: none;
            padding: 12px 16px;
            margin: 0;
            width: 100%;
            font-size: 16px;
            cursor: pointer;
        }

        .sidebar {
            width: 240px;
            background-color: var(--light-color);
            padding: 20px;
            border-right: 3px solid var(--primary-color);
            position: sticky;
            top: 0;
            align-self: flex-start;
            max-height: 100vh;
            overflow-y: auto;
        }

        .navigation {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .nav-btn {
            padding: 10px 16px;
            background-color: var(--primary-color);
            color: var(--text-light);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 15px;
            transition: all 0.3s;
            text-decoration: none;
            display: block;
            text-align: left;
        }

        .nav-btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .content {
            padding: 40px;
            flex: 1;
        }

        .section {
            margin-bottom: 50px;
            padding: 30px;
            background-color: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid var(--primary-color);
        }

        .section h2 {
            color: var(--dark-color);
            margin-bottom: 20px;
            font-size: 2em;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
        }

        .section h3 {
            color: var(--secondary-color);
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .section h4 {
            color: var(--text-color);
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .section p {
            margin-bottom: 15px;
            line-height: 1.8;
        }

        .query-box {
            background-color: var(--code-bg);
            color: var(--code-text);
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-family: 'Courier New', Courier, monospace;
            font-size: 14px;
            overflow-x: auto;
            border-left: 4px solid var(--success-color);
        }

        .query-box code {
            color: var(--code-text);
            display: block;
            white-space: pre-wrap;
        }

        .description {
            background-color: #e8f4f8;
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 10px;
            border-left: 3px solid var(--primary-color);
        }

        .tip {
            background-color: #fff3cd;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 4px solid var(--warning-color);
        }

        .tip strong {
            color: var(--warning-color);
        }

        .important {
            background-color: #f8d7da;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 4px solid var(--danger-color);
        }

        .important strong {
            color: var(--danger-color);
        }

        ul, ol {
            margin-left: 30px;
            margin-bottom: 15px;
        }

        li {
            margin-bottom: 8px;
            line-height: 1.6;
        }

        .table-container {
            overflow-x: auto;
            margin: 20px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        th {
            background-color: var(--primary-color);
            color: var(--text-light);
            padding: 12px;
            text-align: left;
            font-weight: bold;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #ddd;
        }

        tr:hover {
            background-color: #f5f5f5;
        }

        .footer {
            background-color: var(--dark-color);
            color: var(--text-light);
            padding: 20px;
            text-align: center;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .content {
                padding: 20px;
            }

            .section {
                padding: 20px;
            }

            .layout {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                display: none;
                border-right: none;
                border-bottom: 3px solid var(--primary-color);
            }

            .sidebar.open {
                display: block;
            }

            .sidebar-toggle {
                display: block;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõ°Ô∏è SOC Analyst Guide</h1>
            <p>SIEM Query Cheatsheets & Log Analysis Guide</p>
        </div>

        <div class="layout">
            <button class="sidebar-toggle" onclick="document.querySelector('.sidebar').classList.toggle('open')">‚ò∞ Menu</button>
            <div class="sidebar">
                <div class="navigation">
                    <a href="#intro" class="nav-btn">Introduction</a>
                    <a href="#splunk" class="nav-btn">Splunk Queries</a>
                    <a href="#elastic" class="nav-btn">Elastic Queries</a>
                    <a href="#sentinel" class="nav-btn">Microsoft Sentinel</a>
                    <a href="#linux" class="nav-btn">Linux Log Analysis</a>
                    <a href="#best-practices" class="nav-btn">Best Practices</a>
                </div>
            </div>

            <div class="content">
            <!-- Introduction Section -->
            <div id="intro" class="section">
                <h2>üìñ Introduction</h2>
                
                <h3>What is a Security Operations Center (SOC)?</h3>
                <p>A Security Operations Center (SOC) is a centralized unit within an organization that employs people, processes, and technology to continuously monitor, detect, analyze, and respond to cybersecurity incidents. SOC analysts serve as the first line of defense against cyber threats, utilizing Security Information and Event Management (SIEM) systems as their primary investigative tool.</p>
                
                <h3>The Role of SIEM in Security Operations</h3>
                <p>SIEM systems aggregate and correlate log data from diverse sources across an organization's IT infrastructure, including:</p>
                <ul>
                    <li><strong>Network devices:</strong> Firewalls, routers, switches, intrusion detection/prevention systems (IDS/IPS)</li>
                    <li><strong>Endpoints:</strong> Workstations, servers, mobile devices with security agents</li>
                    <li><strong>Applications:</strong> Web servers, databases, custom business applications</li>
                    <li><strong>Security tools:</strong> Antivirus, endpoint detection and response (EDR), data loss prevention (DLP)</li>
                    <li><strong>Cloud services:</strong> AWS CloudTrail, Azure Activity Logs, Google Cloud Audit Logs</li>
                </ul>
                <p>By normalizing and indexing this data, SIEM platforms enable real-time security monitoring, historical analysis, and compliance reporting through sophisticated query languages and correlation rules.</p>
                
                <h3>Fundamental Concepts in Log Analysis</h3>
                <h4>Log Structure and Parsing</h4>
                <p>Logs are structured or semi-structured records of events that occur within systems. Understanding log anatomy is critical:</p>
                <ul>
                    <li><strong>Timestamp:</strong> When the event occurred (essential for temporal correlation)</li>
                    <li><strong>Source:</strong> Which system or component generated the event</li>
                    <li><strong>Event Type/Code:</strong> Classification of the event (e.g., Windows Event ID 4625 for failed logon)</li>
                    <li><strong>Severity Level:</strong> Importance indicator (informational, warning, error, critical)</li>
                    <li><strong>Message/Details:</strong> Descriptive information about the event</li>
                    <li><strong>Contextual Fields:</strong> User, IP address, process name, file path, etc.</li>
                </ul>
                
                <h4>The Cybersecurity Kill Chain</h4>
                <p>SOC analysts use frameworks like the Cyber Kill Chain to understand attack progression:</p>
                <ol>
                    <li><strong>Reconnaissance:</strong> Attacker gathers information about the target</li>
                    <li><strong>Weaponization:</strong> Creation of malicious payload</li>
                    <li><strong>Delivery:</strong> Transmission of weapon to target (email, web, USB)</li>
                    <li><strong>Exploitation:</strong> Execution of code on victim system</li>
                    <li><strong>Installation:</strong> Persistence mechanism establishment</li>
                    <li><strong>Command & Control (C2):</strong> Remote access channel establishment</li>
                    <li><strong>Actions on Objectives:</strong> Data exfiltration, destruction, or other malicious activities</li>
                </ol>
                <p>Each phase generates distinct log signatures that analysts can detect through SIEM queries.</p>
                
                <h3>Query Language Paradigms</h3>
                <p>Different SIEM platforms employ distinct query languages optimized for their underlying data storage:</p>
                <ul>
                    <li><strong>Splunk SPL (Search Processing Language):</strong> Pipeline-based language using the pipe operator (|) to chain search commands</li>
                    <li><strong>Elastic KQL/Lucene:</strong> Kibana Query Language for simple searches, Lucene syntax for complex queries, and DSL for advanced aggregations</li>
                    <li><strong>Microsoft Sentinel KQL (Kusto Query Language):</strong> Declarative language similar to SQL, optimized for Azure Data Explorer backend</li>
                </ul>
                <p>While syntax varies, the analytical approach remains consistent: filter, aggregate, correlate, and visualize security events to identify anomalous behavior.</p>
                
                <h3>How to Use This Guide</h3>
                <p>This comprehensive guide is structured to support both learning and operational reference:</p>
                <ol>
                    <li><strong>Understand the Theory:</strong> Each section begins with conceptual foundations before presenting practical queries</li>
                    <li><strong>Start with the Incident Flow:</strong> Use your SIEM (Splunk/Elastic/Sentinel) to triage alerts according to established playbooks</li>
                    <li><strong>Apply Platform-Specific Queries:</strong> Leverage the detailed query examples to validate and enrich findings during investigations</li>
                    <li><strong>Correlate with System-Level Analysis:</strong> Use Linux terminal commands for deeper visibility when SIEM data alone is insufficient</li>
                    <li><strong>Follow Best Practices:</strong> Apply the methodology section for systematic documentation, tuning, and post-incident activities</li>
                    <li><strong>Adapt and Customize:</strong> Modify queries to fit your organization's specific data sources, naming conventions, and use cases</li>
                </ol>
                
                <div class="important">
                    <strong>‚ö†Ô∏è Academic Context:</strong> This guide bridges theoretical security concepts with practical implementation. Each query is accompanied by its underlying detection logic, potential false positives, and evasion considerations. Understanding the "why" behind each query is as important as knowing the "how."
                </div>
                
                <div class="tip">
                    <strong>üí° Learning Tip:</strong> For maximum benefit, practice these queries in a controlled lab environment before deploying in production. Consider using datasets like Security Onion, BOTS (Boss of the SOC), or custom test data to develop proficiency without impacting live security monitoring.
                </div>
            </div>

            <!-- Splunk Section -->
            <div id="splunk" class="section">
                <h2>üîç Splunk: Enterprise SIEM Platform</h2>
                
                <h3>Splunk Architecture and Data Model</h3>
                <p>Splunk is a distributed search and analytics platform that ingests machine-generated data through Universal Forwarders or HTTP Event Collectors (HEC). Data flows through the following pipeline:</p>
                <ol>
                    <li><strong>Input Layer:</strong> Data collection via forwarders, APIs, or direct file monitoring</li>
                    <li><strong>Parsing Layer:</strong> Event breaking, timestamp extraction, and field identification</li>
                    <li><strong>Indexing Layer:</strong> Data compression and storage in time-series indexes with bloom filters for efficient retrieval</li>
                    <li><strong>Search Layer:</strong> SPL (Search Processing Language) queries execute in distributed fashion across indexers</li>
                </ol>
                <p>Understanding this architecture is crucial for query optimization and troubleshooting performance issues.</p>
                
                <h3>Search Processing Language (SPL) Fundamentals</h3>
                <p>SPL follows a pipeline model where each command transforms the result set before passing it to the next command:</p>
                <div class="query-box">
                    <code>index=main sourcetype=access_combined error
| stats count by src_ip 
| where count > 10
| sort -count</code>
                </div>
                <p><strong>Pipeline breakdown:</strong></p>
                <ul>
                    <li><strong>Line 1:</strong> Base search filters events from the "main" index with sourcetype "access_combined" containing "error"</li>
                    <li><strong>Line 2:</strong> Aggregates events by source IP, counting occurrences</li>
                    <li><strong>Line 3:</strong> Post-processing filter to show only IPs with more than 10 errors</li>
                    <li><strong>Line 4:</strong> Sort results in descending order by count</li>
                </ul>
                
                <h3>Index and Sourcetype Selection Strategy</h3>
                <p>Efficient Splunk queries always specify the index (and ideally sourcetype) to minimize the search scope:</p>
                <ul>
                    <li><strong>index=</strong> Specifies which data repository to search (e.g., security, network, windows)</li>
                    <li><strong>sourcetype=</strong> Identifies the format/parser for the data (e.g., WinEventLog:Security, syslog, firewall:cisco:asa)</li>
                    <li><strong>Time range:</strong> Default is "All time" but should be limited to relevant period (last 24h, last 7d, etc.)</li>
                </ul>
                <div class="tip">
                    <strong>üí° Performance Tip:</strong> Searches without index specification scan all indexes, dramatically increasing query time and resource consumption. Always include index= as the first filter.
                </div>

                <h3>Incident Response Methodology</h3>
                <div class="important">
                    <strong>Splunk Incident Investigation Workflow:</strong>
                    <ol>
                        <li><strong>Alert Triage:</strong> Review notable events dashboard, examining key fields (source/destination IP, username, signature name, severity level)</li>
                        <li><strong>Scope Determination:</strong> Use <code>| tstats</code> command for fast aggregation across time, index, and sourcetype to understand event volume</li>
                        <li><strong>Evidence Collection:</strong> Execute targeted queries to extract relevant events, building a timeline of attacker activity</li>
                        <li><strong>Threat Intelligence Enrichment:</strong> Apply lookups (<code>| lookup threat_intel ip AS src_ip</code>) to contextualize IOCs</li>
                        <li><strong>Response Actions:</strong> Document findings, create adaptive responses (automated blocking/quarantine), and generate reports for stakeholders</li>
                    </ol>
                </div>

                <h3>Authentication Security Analysis</h3>

                <h4>1. Failed Login Attempts (Brute Force Detection)</h4>
                <p><strong>Threat Context:</strong> Brute force attacks attempt to guess credentials through repeated login attempts. This pattern is characteristic of the "Exploitation" phase in the Cyber Kill Chain.</p>
                <div class="description">
                    <strong>Detection Logic:</strong> Aggregate Windows Security Event ID 4625 (failed logon) by source IP and username, filtering for accounts exceeding a threshold.
                </div>
                <div class="query-box">
                    <code>index=security sourcetype=WinEventLog:Security EventCode=4625
| stats count by src_ip, user
| where count > 5
| sort -count</code>
                </div>
                <p><strong>Query Analysis:</strong></p>
                <ul>
                    <li><strong>EventCode=4625:</strong> Windows logs failed authentication attempts with this ID</li>
                    <li><strong>stats count by src_ip, user:</strong> Aggregates by source and target, revealing attack patterns</li>
                    <li><strong>where count > 5:</strong> Threshold should be tuned based on baseline (consider legitimate typos)</li>
                </ul>
                <p><strong>False Positive Considerations:</strong> Legitimate users forgetting passwords, misconfigured services, time synchronization issues. Adjust threshold based on organizational behavior.</p>
                <p><strong>Evasion Techniques:</strong> Attackers may use slow brute force (low-and-slow), distributed sources (botnets), or credential stuffing with valid username/password pairs.</p>

                <h4>2. Successful Logins After Failed Attempts</h4>
                <p><strong>Threat Context:</strong> A successful login (EventCode 4624) immediately following multiple failures strongly indicates credential compromise or successful brute force.</p>
                <div class="description">
                    <strong>Detection Logic:</strong> Use transaction command to correlate temporally related authentication events for the same user within a 30-minute window.
                </div>
                <div class="query-box">
                    <code>index=security (EventCode=4625 OR EventCode=4624)
| transaction user maxspan=30m
| search EventCode=4625 EventCode=4624
| stats count by user, src_ip</code>
                </div>
                <p><strong>Query Analysis:</strong></p>
                <ul>
                    <li><strong>transaction user maxspan=30m:</strong> Groups events for the same user within 30 minutes into transactions</li>
                    <li><strong>search EventCode=4625 EventCode=4624:</strong> Filters transactions containing BOTH failed and successful logins</li>
                    <li><strong>Temporal window:</strong> 30 minutes is default; adjust based on typical attack speed vs. legitimate retry patterns</li>
                </ul>
                <p><strong>Alternative Approach:</strong> Consider using <code>| streamstats</code> or <code>| eventstats</code> for real-time detection rather than batch processing.</p>
                <p><strong>Investigation Next Steps:</strong> Examine source IP geolocation, compare against user's typical login locations, check for subsequent lateral movement or privilege escalation.</p>

                <h4>3. Privilege Escalation Detection</h4>
                <p><strong>Threat Context:</strong> Privilege escalation is a critical phase where attackers elevate their access rights. Windows Event ID 4672 logs whenever special privileges are assigned to a new logon.</p>
                <div class="description">
                    <strong>Detection Logic:</strong> Monitor privilege assignment events, focusing on unusual frequency or logon types (especially Type 3: Network, Type 10: RemoteInteractive).
                </div>
                <div class="query-box">
                    <code>index=security EventCode=4672
| stats count by user, Logon_Type
| where count > 10</code>
                </div>
                <p><strong>Query Analysis:</strong></p>
                <ul>
                    <li><strong>EventCode=4672:</strong> Special privileges assigned to new logon (SeSecurityPrivilege, SeBackupPrivilege, SeDebugPrivilege)</li>
                    <li><strong>Logon_Type field:</strong> Reveals how privilege was obtained (2=Interactive, 3=Network, 4=Batch, 5=Service, 10=RemoteInteractive)</li>
                    <li><strong>Baseline awareness:</strong> Administrator accounts will trigger this frequently; focus on user accounts or service accounts</li>
                </ul>
                <p><strong>Enhanced Detection:</strong> Cross-reference with Event ID 4673 (privileged service called) and 4674 (privileged operation attempted) for complete privilege abuse timeline.</p>
                <p><strong>MITRE ATT&CK Mapping:</strong> T1078 (Valid Accounts), T1068 (Exploitation for Privilege Escalation)</p>

                <h4>4. Data Exfiltration Detection</h4>
                <p><strong>Threat Context:</strong> Data exfiltration represents the final objective phase where attackers transmit stolen data to external infrastructure. Large outbound transfers, especially to unusual destinations, warrant investigation.</p>
                <div class="description">
                    <strong>Detection Logic:</strong> Analyze firewall or proxy logs for high-volume outbound connections to non-RFC1918 addresses, aggregating by source, destination, and user.
                </div>
                <div class="query-box">
                    <code>index=network sourcetype=firewall action=allowed
| eval bytes_mb=bytes/1024/1024
| where bytes_mb > 100 AND NOT (dest_ip="10.*" OR dest_ip="192.168.*")
| stats sum(bytes_mb) as total_mb by src_ip, dest_ip, user
| sort -total_mb</code>
                </div>
                <p><strong>Query Analysis:</strong></p>
                <ul>
                    <li><strong>eval bytes_mb:</strong> Converts raw byte counts to megabytes for human readability</li>
                    <li><strong>NOT (dest_ip="10.*" OR dest_ip="192.168.*"):</strong> Excludes internal RFC1918 addresses (also consider 172.16.0.0/12)</li>
                    <li><strong>Threshold of 100MB:</strong> Should be adjusted based on organization's normal file transfer patterns</li>
                </ul>
                <p><strong>Advanced Considerations:</strong></p>
                <ul>
                    <li>Attackers may use DNS tunneling, ICMP tunneling, or steganography to evade detection</li>
                    <li>Consider protocol analysis: large HTTPS uploads, unusual port usage</li>
                    <li>Temporal patterns: transfers during off-hours are more suspicious</li>
                    <li>Baseline each user/system's typical outbound data volume</li>
                </ul>
                <p><strong>Complementary Queries:</strong> Correlate with DLP (Data Loss Prevention) alerts, examine file access logs (EventCode 4663), check for archive creation (.zip, .7z, .rar) before transfer.</p>

                <h4>5. Malware Detection via Process Creation</h4>
                <p><strong>Threat Context:</strong> Attackers frequently use PowerShell and Command Prompt for fileless malware, living-off-the-land techniques, and remote code execution. Event ID 4688 logs process creation when command-line auditing is enabled.</p>
                <div class="description">
                    <strong>Detection Logic:</strong> Search for encoded PowerShell commands, web download functions, or execution operators that suggest malicious script execution.
                </div>
                <div class="query-box">
                    <code>index=windows EventCode=4688
| search (process_name="*powershell.exe*" OR process_name="*cmd.exe*")
| search command_line="*-enc*" OR command_line="*downloadstring*" OR command_line="*invoke-expression*"
| stats count by host, user, process_name, command_line</code>
                </div>
                <p><strong>Query Analysis:</strong></p>
                <ul>
                    <li><strong>-enc or -EncodedCommand:</strong> Base64-encoded PowerShell payload (common obfuscation technique)</li>
                    <li><strong>downloadstring:</strong> .NET method to download remote content (commonly used in malware droppers)</li>
                    <li><strong>invoke-expression (IEX):</strong> Executes strings as PowerShell code (indicator of dynamic code execution)</li>
                </ul>
                <p><strong>Additional Malicious Patterns to Monitor:</strong></p>
                <ul>
                    <li><code>-nop -w hidden</code>: No profile, hidden window (stealth execution)</li>
                    <li><code>Start-BitsTransfer</code>: Background Intelligent Transfer Service (legitimate tool abused for download)</li>
                    <li><code>Invoke-WebRequest</code> or <code>curl</code>: Web request functions</li>
                    <li><code>mimikatz</code>, <code>sekurlsa</code>: Credential dumping tools</li>
                </ul>
                <p><strong>False Positive Mitigation:</strong> Whitelist known administrative scripts (hash-based or path-based), exclude system accounts performing legitimate automation.</p>
                <p><strong>MITRE ATT&CK Mapping:</strong> T1059.001 (PowerShell), T1027 (Obfuscated Files or Information), T1105 (Ingress Tool Transfer)</p>

                <h4>6. Network Anomaly Detection (Port Scanning)</h4>
                <p><strong>Threat Context:</strong> Port scanning is reconnaissance activity where attackers probe systems for open ports/services. High unique port counts from a single source indicate scanning tools (Nmap, Masscan).</p>
                <div class="description">
                    <strong>Detection Logic:</strong> Use distinct count (dc) to find sources contacting an unusually high number of unique destination ports.
                </div>
                <div class="query-box">
                    <code>index=network
| stats dc(dest_port) as unique_ports, values(dest_port) as ports by src_ip
| where unique_ports > 100
| sort -unique_ports</code>
                </div>
                <p><strong>Query Analysis:</strong></p>
                <ul>
                    <li><strong>dc(dest_port):</strong> Distinct count function identifies unique ports accessed</li>
                    <li><strong>values(dest_port):</strong> Lists all accessed ports for forensic analysis</li>
                    <li><strong>Threshold of 100 ports:</strong> Legitimate systems rarely contact >100 ports; adjust based on network profile</li>
                </ul>
                <p><strong>Scan Types and Detection:</strong></p>
                <ul>
                    <li><strong>Horizontal scan:</strong> Many hosts, few ports (add dest_ip distinct count)</li>
                    <li><strong>Vertical scan:</strong> Few hosts, many ports (current query)</li>
                    <li><strong>Slow scan:</strong> May evade detection; consider longer time windows</li>
                </ul>
                <p><strong>MITRE ATT&CK Mapping:</strong> T1046 (Network Service Scanning)</p>

                <h4>7. Web Application Attacks (SQLi & XSS Detection)</h4>
                <p><strong>Threat Context:</strong> Web applications are frequent attack vectors. SQL Injection (SQLi) manipulates database queries, while Cross-Site Scripting (XSS) injects malicious JavaScript into web pages.</p>
                <div class="description">
                    <strong>Detection Logic:</strong> Pattern match URI parameters for common SQLi and XSS syntax, correlating with HTTP response codes.
                </div>
                <div class="query-box">
                    <code>index=web sourcetype=access_combined
| search (uri="*union*select*" OR uri="*script*" OR uri="*exec*" OR uri="*drop*table*")
| stats count by src_ip, uri, status
| sort -count</code>
                </div>
                <p><strong>Query Analysis:</strong></p>
                <ul>
                    <li><strong>union*select:</strong> SQL UNION-based injection attempt</li>
                    <li><strong>script:</strong> Potential XSS payload (e.g., &lt;script&gt;alert()&lt;/script&gt;)</li>
                    <li><strong>exec, drop*table:</strong> SQL command injection patterns</li>
                    <li><strong>Status code correlation:</strong> 200 (success) may indicate vulnerability, 403/500 suggests blocking</li>
                </ul>
                <p><strong>Enhanced Detection Patterns:</strong></p>
                <ul>
                    <li>Add: <code>OR uri="*' OR '1'='1*"</code> (authentication bypass)</li>
                    <li>Add: <code>OR uri="*../..%2F*"</code> (directory traversal)</li>
                    <li>Add: <code>OR uri="*cmd=*"</code> (OS command injection)</li>
                    <li>Consider URL-decoded analysis: <code>| eval uri_decoded=urldecode(uri)</code></li>
                </ul>
                <p><strong>False Positives:</strong> Legitimate application features, security scanners, penetration tests. Whitelist authorized security testing.</p>
                <p><strong>MITRE ATT&CK Mapping:</strong> T1190 (Exploit Public-Facing Application)</p>

                <h4>8. Time-Based Analysis (Temporal Pattern Detection)</h4>
                <p><strong>Threat Context:</strong> Visualizing event distribution over time reveals attack patterns, identifies peak attack periods, and helps establish baselines for anomaly detection.</p>
                <div class="description">
                    <strong>Detection Logic:</strong> Create time-series visualization of failed login attempts, segmented by user.
                </div>
                <div class="query-box">
                    <code>index=security EventCode=4625
| timechart span=1h count by user</code>
                </div>
                <p><strong>Query Analysis:</strong></p>
                <ul>
                    <li><strong>timechart:</strong> Automatically bins events by time and creates statistical summary</li>
                    <li><strong>span=1h:</strong> One-hour buckets; adjust based on analysis needs (5m for real-time, 1d for trends)</li>
                    <li><strong>count by user:</strong> Creates separate time series for each user (limit 10 by default)</li>
                </ul>
                <p><strong>Analytical Insights:</strong></p>
                <ul>
                    <li><strong>Spikes:</strong> Sudden increases suggest automated attacks</li>
                    <li><strong>Periodic patterns:</strong> May indicate scheduled tasks or persistent threats</li>
                    <li><strong>Off-hours activity:</strong> Events outside business hours warrant investigation</li>
                    <li><strong>Comparison:</strong> Use <code>timechart ... by user limit=0</code> to aggregate all users</li>
                </ul>
                <p><strong>Advanced Visualization:</strong> Combine with <code>| predict</code> for machine learning-based anomaly detection or <code>| baseline</code> for statistical deviation analysis.</p>

                <h4>9. User Behavior Analytics (Impossible Travel Detection)</h4>
                <p><strong>Threat Context:</strong> Compromised credentials are often used from multiple geographic locations. Users appearing from multiple IPs simultaneously or from geographically distant locations in short time periods indicate account compromise.</p>
                <div class="description">
                    <strong>Detection Logic:</strong> Identify users authenticating from an anomalous number of distinct source IPs within the analysis timeframe.
                </div>
                <div class="query-box">
                    <code>index=security EventCode=4624
| stats count, dc(src_ip) as unique_ips, values(src_ip) as ips by user
| where unique_ips > 5
| sort -unique_ips</code>
                </div>
                <p><strong>Query Analysis:</strong></p>
                <ul>
                    <li><strong>dc(src_ip):</strong> Distinct count of source IPs per user</li>
                    <li><strong>values(src_ip):</strong> Lists all IPs for manual review</li>
                    <li><strong>Threshold of 5:</strong> Depends on user role (executives travel, remote workers VPN); tune per user/department</li>
                </ul>
                <p><strong>Enhanced Detection with Geolocation:</strong></p>
                <div class="query-box">
                    <code>index=security EventCode=4624
| iplocation src_ip
| stats dc(Country) as countries, values(Country) as country_list by user
| where countries > 2</code>
                </div>
                <p><strong>Impossible Travel Detection:</strong> Calculate geographic distance and time delta between consecutive logins to detect physically impossible travel scenarios.</p>
                <p><strong>MITRE ATT&CK Mapping:</strong> T1078 (Valid Accounts), T1133 (External Remote Services)</p>

                <h4>10. Threat Intelligence Integration</h4>
                <p><strong>Threat Context:</strong> External threat intelligence feeds provide context about known malicious infrastructure (C2 servers, malware distribution sites, scanning hosts). Integrating these feeds enriches security events with actionable threat data.</p>
                <div class="description">
                    <strong>Detection Logic:</strong> Use Splunk lookups to match network destinations against threat intelligence databases, filtering for confirmed threats.
                </div>
                <div class="query-box">
                    <code>index=network
| lookup threat_intel_ips ip as dest_ip OUTPUT threat_level, category
| where isnotnull(threat_level)
| stats count by src_ip, dest_ip, threat_level, category</code>
                </div>
                <p><strong>Query Analysis:</strong></p>
                <ul>
                    <li><strong>lookup threat_intel_ips:</strong> References CSV lookup table containing known bad IPs</li>
                    <li><strong>OUTPUT threat_level, category:</strong> Enriches events with threat severity and classification</li>
                    <li><strong>isnotnull(threat_level):</strong> Filters only events matching threat intelligence</li>
                </ul>
                <p><strong>Threat Intelligence Sources:</strong></p>
                <ul>
                    <li><strong>Commercial feeds:</strong> Recorded Future, CrowdStrike, Anomali (high fidelity, subscription-based)</li>
                    <li><strong>Open source:</strong> AlienVault OTX, AbuseIPDB, EmergingThreats (free but may have higher false positives)</li>
                    <li><strong>Government feeds:</strong> CISA, FBI InfraGard (sector-specific intelligence)</li>
                </ul>
                <p><strong>Lookup Table Maintenance:</strong> Implement automated updates (daily/hourly) via scripts or Splunk apps. Monitor feed freshness and accuracy.</p>
                <p><strong>Bidirectional Analysis:</strong> Also check source IPs (<code>lookup ... ip as src_ip</code>) to detect compromised internal hosts.</p>

                <div class="tip">
                    <strong>üí° Splunk Performance Optimization:</strong>
                    <ul>
                        <li><strong>Testing:</strong> Use <code>| head 100</code> to limit results during query development</li>
                        <li><strong>Field selection:</strong> Use <code>| fields src_ip, dest_ip, user</code> to return only necessary fields</li>
                        <li><strong>Fast mode:</strong> Enable in search bar for preliminary analysis (disables field discovery)</li>
                        <li><strong>tstats:</strong> Use <code>| tstats</code> instead of stats for accelerated data models (10-1000x faster)</li>
                        <li><strong>Summary indexing:</strong> Pre-compute frequently used aggregations</li>
                        <li><strong>Subsearches:</strong> Use sparingly; often <code>join</code> or <code>lookup</code> is more efficient</li>
                    </ul>
                </div>
                
                <div class="important">
                    <strong>‚ö†Ô∏è Operational Considerations:</strong> Always validate queries in a test environment before deploying as scheduled searches or alerts. Monitor search resource usage (CPU, memory) and set appropriate scheduling priorities. Document query purpose, data sources, and expected results for knowledge transfer.
                </div>
            </div>

            <!-- Elastic Section -->
            <div id="elastic" class="section">
                <h2>üîé Elastic (ELK Stack): Open Source Security Analytics</h2>
                
                <h3>Elastic Stack Architecture</h3>
                <p>The Elastic Stack (formerly ELK Stack) is a collection of open-source tools for searching, analyzing, and visualizing log data in real-time:</p>
                <ul>
                    <li><strong>Elasticsearch:</strong> Distributed search and analytics engine built on Apache Lucene, storing data as JSON documents in inverted indices</li>
                    <li><strong>Logstash:</strong> Server-side data processing pipeline that ingests, transforms, and forwards data to Elasticsearch</li>
                    <li><strong>Kibana:</strong> Visualization and exploration interface providing dashboards, query builders, and investigation tools</li>
                    <li><strong>Beats:</strong> Lightweight data shippers (Filebeat, Metricbeat, Packetbeat, Winlogbeat) deployed on endpoints</li>
                </ul>
                <p>Elastic Security (formerly SIEM) adds pre-built detection rules, timeline analysis, case management, and threat intelligence integration.</p>
                
                <h3>Elastic Common Schema (ECS)</h3>
                <p>ECS is a standardized field naming convention ensuring consistent data structure across diverse sources:</p>
                <ul>
                    <li><strong>@timestamp:</strong> Event occurrence time (ISO 8601 format)</li>
                    <li><strong>event.*:</strong> Event metadata (category, action, outcome, type)</li>
                    <li><strong>user.*:</strong> User identity (name, id, domain)</li>
                    <li><strong>source/destination.*:</strong> Network endpoints (ip, port, geo)</li>
                    <li><strong>process.*:</strong> Process details (name, pid, command_line, parent)</li>
                    <li><strong>file.*:</strong> File operations (path, name, hash)</li>
                </ul>
                <p>ECS compliance enables seamless integration of diverse data sources and correlation across security events.</p>
                
                <h3>Query Languages in Elastic</h3>
                
                <h4>Kibana Query Language (KQL)</h4>
                <p>KQL is a simplified query syntax for Kibana's Discover and Dashboard interfaces:</p>
                <div class="query-box">
                    <code>event.action: "login" AND user.name: "admin" AND NOT event.outcome: "success"</code>
                </div>
                <p><strong>KQL Features:</strong></p>
                <ul>
                    <li><strong>Field:value syntax:</strong> Simple equality matching with automatic field type handling</li>
                    <li><strong>Wildcard support:</strong> <code>process.name: "powershell*"</code> or <code>url.path: "/api/*/user"</code></li>
                    <li><strong>Boolean operators:</strong> AND, OR, NOT (case-sensitive)</li>
                    <li><strong>Range queries:</strong> <code>bytes: &gt;= 1000 AND bytes: &lt; 10000</code></li>
                    <li><strong>Nested field access:</strong> Automatically handles nested objects</li>
                </ul>
                
                <h4>Elasticsearch Query DSL (Domain Specific Language)</h4>
                <p>DSL is a JSON-based query language for programmatic API access with advanced capabilities:</p>
                <ul>
                    <li><strong>Full-text search:</strong> Analyzed text matching with relevance scoring</li>
                    <li><strong>Aggregations:</strong> Statistical analysis, grouping, and bucketing</li>
                    <li><strong>Scripting:</strong> Custom logic using Painless scripting language</li>
                    <li><strong>Geospatial queries:</strong> Location-based filtering and distance calculations</li>
                </ul>
                
                <h3>Incident Response Workflow</h3>
                <div class="important">
                    <strong>Elastic Security Investigation Methodology:</strong>
                    <ol>
                        <li><strong>Alert Triage:</strong> Open alert in Security ‚Üí Detection Engine, inspect rule logic and matched fields</li>
                        <li><strong>Contextual Pivoting:</strong> Use "View in Discover" to explore related events with automatic filters (source/destination, user, host)</li>
                        <li><strong>Query Refinement:</strong> Access raw DSL via "Inspect" ‚Üí "Request" to understand underlying query, modify, and rerun</li>
                        <li><strong>Timeline Construction:</strong> Build investigation timeline with evidence panels, annotate findings, and correlate events</li>
                        <li><strong>Response Actions:</strong> Isolate compromised hosts via Endpoint Security integration, disable user accounts, create cases for tracking</li>
                        <li><strong>Threat Hunting:</strong> Leverage Machine Learning jobs and anomaly detection for proactive threat discovery</li>
                    </ol>
                </div>

                <h3>Detection Queries</h3>

                <h4>1. Failed Authentication Detection</h4>
                <p><strong>Threat Context:</strong> Failed authentication events are primary indicators of credential-based attacks (brute force, password spraying, credential stuffing).</p>
                <div class="description">
                    <strong>Detection Logic:</strong> Query authentication failure events from the last hour, aggregating by username to identify targeted accounts.
                </div>
                <div class="query-box">
                    <code>GET /logs-*/_search
{
  "query": {
    "bool": {
      "must": [
        { "match": { "event.action": "authentication_failure" }}
      ],
      "filter": [
        { "range": { "@timestamp": { "gte": "now-1h" }}}
      ]
    }
  },
  "aggs": {
    "by_user": {
      "terms": { "field": "user.name.keyword", "size": 10 }
    }
  }
}</code>
                </div>
                <p><strong>Query Analysis:</strong></p>
                <ul>
                    <li><strong>bool query:</strong> Combines multiple query clauses (must, filter, should, must_not)</li>
                    <li><strong>match:</strong> Full-text search on analyzed fields</li>
                    <li><strong>filter context:</strong> Range query in filter (cached, no scoring) for performance</li>
                    <li><strong>terms aggregation:</strong> Groups results by user.name.keyword (non-analyzed field for exact matching)</li>
                    <li><strong>Index pattern /logs-*/_search:</strong> Searches all indices matching the pattern</li>
                </ul>
                <p><strong>ECS Compliance:</strong> Uses standard ECS fields (event.action, @timestamp, user.name) ensuring compatibility with diverse data sources.</p>

                <h4>2. Brute Force Attack Detection</h4>
                <p><strong>Threat Context:</strong> Brute force attacks generate high volumes of authentication failures from the same source, attempting to compromise accounts through credential guessing.</p>
                <div class="description">
                    <strong>Detection Logic:</strong> Aggregate authentication failures by source IP with nested aggregation counting attempts, revealing attack sources.
                </div>
                <div class="query-box">
                    <code>GET /logs-*/_search
{
  "query": {
    "bool": {
      "must": [
        { "match": { "event.outcome": "failure" }},
        { "match": { "event.category": "authentication" }}
      ]
    }
  },
  "aggs": {
    "by_source_ip": {
      "terms": { "field": "source.ip", "size": 20 },
      "aggs": {
        "failed_count": { "value_count": { "field": "event.outcome" }}
      }
    }
  },
  "size": 0
}</code>
                </div>
                <p><strong>Query Analysis:</strong></p>
                <ul>
                    <li><strong>Multiple must clauses:</strong> Both conditions must be satisfied (AND logic)</li>
                    <li><strong>event.category: authentication:</strong> ECS category for all auth-related events</li>
                    <li><strong>Nested aggregations:</strong> Sub-aggregation counts failures per IP</li>
                    <li><strong>size: 0:</strong> Returns only aggregation results, not individual documents (performance optimization)</li>
                </ul>
                <p><strong>Advanced Analysis:</strong> Enhance with <code>"min_doc_count": 5</code> parameter in terms aggregation to show only IPs exceeding threshold.</p>
                <p><strong>Visualization:</strong> Create Kibana heatmap showing attack intensity over time, or geographic map showing attacker locations.</p>

                <h4>3. Network Connection Monitoring</h4>
                <p><strong>Threat Context:</strong> Monitoring outbound connections identifies C2 communications, data exfiltration, and lateral movement to external infrastructure.</p>
                <div class="description">
                    <strong>Detection Logic:</strong> Filter network flows excluding RFC1918 private addresses, aggregating external destinations.
                </div>
                <div class="query-box">
                    <code>GET /network-*/_search
{
  "query": {
    "bool": {
      "must": [
        { "match": { "event.action": "network_flow" }}
      ],
      "must_not": [
        { "prefix": { "destination.ip": "10." }},
        { "prefix": { "destination.ip": "192.168." }},
        { "prefix": { "destination.ip": "172." }}
      ]
    }
  },
  "aggs": {
    "top_destinations": {
      "terms": { "field": "destination.ip", "size": 50 }
    }
  }
}</code>
                </div>
                <p><strong>Query Analysis:</strong></p>
                <ul>
                    <li><strong>must_not clause:</strong> Exclusion logic for filtering internal traffic</li>
                    <li><strong>prefix match:</strong> Efficient filtering for IP ranges (consider 172.16-31 for full RFC1918 compliance)</li>
                    <li><strong>Limitation:</strong> Also exclude multicast (224.0.0.0/4), loopback (127.0.0.0/8), and link-local (169.254.0.0/16)</li>
                </ul>
                <p><strong>Enhanced Detection:</strong> Add geolocation aggregation and filter for unexpected countries, or integrate with threat intelligence.</p>
                <p><strong>MITRE ATT&CK:</strong> T1071 (Application Layer Protocol), T1041 (Exfiltration Over C2 Channel)</p>

                <h4>4. Process Execution Monitoring</h4>
                <p><strong>Threat Context:</strong> Malicious PowerShell usage is prevalent in modern attacks for remote code execution, credential harvesting, and living-off-the-land techniques.</p>
                <div class="description">
                    <strong>Detection Logic:</strong> Use wildcard matching on process command lines to identify encoded commands and web-based payload delivery.
                </div>
                <div class="query-box">
                    <code>GET /endpoint-*/_search
{
  "query": {
    "bool": {
      "must": [
        { "match": { "event.category": "process" }}
      ],
      "should": [
        { "wildcard": { "process.command_line": "*powershell*-enc*" }},
        { "wildcard": { "process.command_line": "*invoke-expression*" }},
        { "wildcard": { "process.command_line": "*downloadstring*" }}
      ],
      "minimum_should_match": 1
    }
  }
}</code>
                </div>
                <p><strong>Query Analysis:</strong></p>
                <ul>
                    <li><strong>should clause with minimum_should_match:</strong> OR logic requiring at least one pattern to match</li>
                    <li><strong>wildcard:</strong> Pattern matching with * (any characters); case-sensitive by default</li>
                    <li><strong>Performance consideration:</strong> Wildcards on analyzed text fields are expensive; use .keyword suffix for exact matching</li>
                </ul>
                <p><strong>Additional Suspicious Patterns:</strong> <code>bypass</code>, <code>-nop -w hidden</code>, <code>FromBase64String</code>, <code>Net.WebClient</code></p>
                <p><strong>MITRE ATT&CK:</strong> T1059.001 (PowerShell), T1027 (Obfuscated Files or Information)</p>

                <h4>5. File Modification Detection</h4>
                <p><strong>Threat Context:</strong> Modifications to critical system files indicate privilege escalation, persistence mechanisms, or system compromise.</p>
                <div class="description">
                    <strong>Detection Logic:</strong> Monitor file modification events on critical system paths across Windows and Linux systems.
                </div>
                <div class="query-box">
                    <code>GET /endpoint-*/_search
{
  "query": {
    "bool": {
      "must": [
        { "match": { "event.category": "file" }},
        { "match": { "event.action": "modification" }}
      ],
      "should": [
        { "wildcard": { "file.path": "*/etc/passwd" }},
        { "wildcard": { "file.path": "*/etc/shadow" }},
        { "wildcard": { "file.path": "*\\Windows\\System32\\*" }}
      ],
      "minimum_should_match": 1
    }
  }
}</code>
                </div>
                <p><strong>Critical Paths to Monitor:</strong></p>
                <ul>
                    <li><strong>Linux:</strong> /etc/passwd, /etc/shadow, /etc/sudoers, /etc/crontab, ~/.ssh/authorized_keys</li>
                    <li><strong>Windows:</strong> C:\Windows\System32\*, Registry hives (SAM, SYSTEM), startup folders</li>
                    <li><strong>Application:</strong> Web server roots, database files, application configurations</li>
                </ul>
                <p><strong>File Integrity Monitoring (FIM):</strong> Combine with hash comparison (file.hash.sha256) to detect unauthorized modifications.</p>
                <p><strong>MITRE ATT&CK:</strong> T1078 (Valid Accounts), T1547 (Boot or Logon Autostart Execution)</p>

                <h4>6. Web Application Attack Detection</h4>
                <p><strong>Threat Context:</strong> Web applications are exposed attack surfaces vulnerable to injection attacks that can lead to data breaches.</p>
                <div class="description">
                    <strong>Detection Logic:</strong> Use regular expressions to pattern-match common SQLi and XSS payloads in URLs.
                </div>
                <div class="query-box">
                    <code>GET /web-*/_search
{
  "query": {
    "bool": {
      "should": [
        { "regexp": { "url.full": ".*union.*select.*" }},
        { "regexp": { "url.full": ".*&lt;script&gt;.*" }},
        { "regexp": { "url.full": ".*exec.*" }}
      ],
      "minimum_should_match": 1
    }
  },
  "aggs": {
    "by_source_ip": {
      "terms": { "field": "source.ip", "size": 20 }
    }
  }
}</code>
                </div>
                <p><strong>Query Analysis:</strong></p>
                <ul>
                    <li><strong>regexp:</strong> Supports full regular expression syntax (more powerful but slower than wildcard)</li>
                    <li><strong>.*:</strong> Matches any characters (equivalent to * in wildcard)</li>
                    <li><strong>Case sensitivity:</strong> Elasticsearch regexes are case-sensitive by default</li>
                </ul>
                <p><strong>Enhanced Patterns:</strong></p>
                <ul>
                    <li><strong>SQLi:</strong> <code>' OR '1'='1</code>, <code>; DROP TABLE</code>, <code>UNION ALL SELECT</code></li>
                    <li><strong>XSS:</strong> <code>&lt;iframe&gt;</code>, <code>javascript:</code>, <code>onerror=</code></li>
                    <li><strong>Command Injection:</strong> <code>; ls</code>, <code>| cat /etc/passwd</code></li>
                </ul>
                <p><strong>Correlation:</strong> Match with HTTP response codes (200 = possible success, 500 = error, 403 = blocked)</p>
                <p><strong>MITRE ATT&CK:</strong> T1190 (Exploit Public-Facing Application)</p>

                <h4>7. DNS Tunneling Detection</h4>
                <p><strong>Threat Context:</strong> DNS tunneling abuses DNS protocol to exfiltrate data or establish C2 channels, bypassing traditional firewall rules that allow DNS traffic.</p>
                <div class="description">
                    <strong>Detection Logic:</strong> Analyze DNS query patterns using aggregations to identify domains with suspicious characteristics (high query volume, many unique subdomains).
                </div>
                <div class="query-box">
                    <code>GET /dns-*/_search
{
  "query": {
    "bool": {
      "must": [
        { "match": { "dns.type": "query" }}
      ]
    }
  },
  "aggs": {
    "by_domain": {
      "terms": { 
        "field": "dns.question.name.keyword", 
        "size": 100,
        "order": { "query_count": "desc" }
      },
      "aggs": {
        "query_count": { "value_count": { "field": "dns.question.name.keyword" }},
        "unique_subdomains": { "cardinality": { "field": "dns.question.name.keyword" }}
      }
    }
  }
}</code>
                </div>
                <p><strong>Query Analysis:</strong></p>
                <ul>
                    <li><strong>Nested aggregations:</strong> Count total queries AND unique subdomain count per domain</li>
                    <li><strong>cardinality aggregation:</strong> Approximate distinct count (uses HyperLogLog algorithm)</li>
                    <li><strong>order parameter:</strong> Sorts buckets by nested aggregation value</li>
                </ul>
                <p><strong>DNS Tunneling Indicators:</strong></p>
                <ul>
                    <li><strong>High query volume:</strong> Hundreds or thousands of queries to same domain</li>
                    <li><strong>Unusual subdomain patterns:</strong> Long, random-looking subdomains (encoded data)</li>
                    <li><strong>Request/response size:</strong> Unusually large TXT records or response sizes</li>
                    <li><strong>Query frequency:</strong> Regular, automated patterns</li>
                </ul>
                <p><strong>Advanced Detection:</strong> Use Elasticsearch ML anomaly detection on query length, entropy, and frequency patterns.</p>
                <p><strong>MITRE ATT&CK:</strong> T1071.004 (Application Layer Protocol: DNS), T1048.003 (Exfiltration Over Alternative Protocol: DNS)</p>

                <h4>8. Time-Series Anomaly Detection</h4>
                <p><strong>Threat Context:</strong> Temporal analysis reveals attack patterns, identifies peak activity periods, and establishes behavioral baselines.</p>
                <div class="query-box">
                    <code>GET /logs-*/_search
{
  "query": {
    "range": { "@timestamp": { "gte": "now-24h" }}
  },
  "aggs": {
    "events_over_time": {
      "date_histogram": {
        "field": "@timestamp",
        "fixed_interval": "1h"
      },
      "aggs": {
        "by_category": {
          "terms": { "field": "event.category" }
        }
      }
    }
  },
  "size": 0
}</code>
                </div>
                <p><strong>Advanced Capabilities:</strong></p>
                <ul>
                    <li><strong>date_histogram:</strong> Time-based bucketing (minute, hour, day intervals)</li>
                    <li><strong>Moving averages:</strong> Add pipeline aggregations for trend analysis</li>
                    <li><strong>Percentile aggregations:</strong> Identify outliers statistically</li>
                    <li><strong>Machine Learning:</strong> Elastic ML can automatically detect anomalies in time-series data</li>
                </ul>

                <div class="tip">
                    <strong>üí° Elastic Performance Best Practices:</strong>
                    <ul>
                        <li><strong>Index patterns:</strong> Use specific index patterns (/logs-2024.01.*/) instead of wildcards when possible</li>
                        <li><strong>Keyword fields:</strong> Use .keyword suffix for aggregations and exact matching</li>
                        <li><strong>Filter context:</strong> Place range queries in filter clause for caching</li>
                        <li><strong>Size parameter:</strong> Set "size": 0 when only aggregations are needed</li>
                        <li><strong>Scroll API:</strong> Use for large result sets (>10,000 documents)</li>
                        <li><strong>Index lifecycle management:</strong> Implement hot-warm-cold architecture for cost optimization</li>
                    </ul>
                </div>
                
                <div class="important">
                    <strong>‚ö†Ô∏è Elastic Security Integration:</strong> Leverage Elastic Security's pre-built detection rules based on MITRE ATT&CK framework. These rules are continuously updated by Elastic's threat research team and provide high-fidelity detections with minimal tuning required. Customize rules to match your environment and disable noisy detections.
                </div>
            </div>

                <h4>8. Time-Series Anomaly Detection</h4>
                <div class="description">
                    Use date histogram for pattern analysis:
                </div>
                <div class="query-box">
                    <code>GET /logs-*/_search
{
  "query": {
    "match": { "event.category": "authentication" }
  },
  "aggs": {
    "events_over_time": {
      "date_histogram": {
        "field": "@timestamp",
        "fixed_interval": "1h"
      },
      "aggs": {
        "by_outcome": {
          "terms": { "field": "event.outcome" }
        }
      }
    }
  },
  "size": 0
}</code>
                </div>

                <h3>KQL Examples for Kibana Discover</h3>

                <h4>Basic KQL Queries</h4>
                <div class="query-box">
                    <code>// Failed SSH logins
event.action: "ssh_login" AND event.outcome: "failure"

// Successful privileged operations
event.action: "sudo" AND event.outcome: "success"

// Large file uploads
http.request.method: "POST" AND http.request.bytes > 10000000

// Suspicious PowerShell execution
process.name: "powershell.exe" AND process.command_line: *encoded*

// Multiple failed logins from same IP
source.ip: * AND event.outcome: "failure" AND event.category: "authentication"</code>
                </div>

                <div class="tip">
                    <strong>üí° Elastic Tips:</strong>
                    <ul>
                        <li>Use field aggregations for statistical analysis</li>
                        <li>Leverage Elastic Machine Learning for anomaly detection</li>
                        <li>Create index patterns for efficient data organization</li>
                        <li>Use visualization dashboards for real-time monitoring</li>
                        <li>Save frequently used queries as saved searches</li>
                    </ul>
                </div>
            </div>

            <!-- Microsoft Sentinel Section -->
            <div id="sentinel" class="section">
                <h2>üõ∞Ô∏è Microsoft Sentinel Runbook</h2>
                <p>Step-by-step guide for investigating alerts and hunting threats in Microsoft Sentinel using KQL, workbooks, and incident tools.</p>

                <h3>Core Log Tables</h3>
                <ul>
                    <li><strong>SecurityEvent</strong> (Windows), <strong>DeviceEvents</strong> / <strong>DeviceProcessEvents</strong> (Defender for Endpoint)</li>
                    <li><strong>SigninLogs</strong> &amp; <strong>AuditLogs</strong> (Entra ID), <strong>OfficeActivity</strong> (M365), <strong>CommonSecurityLog</strong> (firewalls/proxies)</li>
                    <li><strong>Syslog</strong> (Linux), <strong>AzureDiagnostics</strong> (platform), <strong>Heartbeat</strong> (agent health)</li>
                </ul>

                <div class="important">
                    <strong>Sentinel incident playbook:</strong>
                    <ol>
                        <li>Incident ‚Üí review entities, evidence, severity, owner.</li>
                        <li>Investigation graph ‚Üí expand entities, note related alerts/IPs/processes.</li>
                        <li>View in Logs ‚Üí run KQL from templates below; adjust time/filters.</li>
                        <li>Workbooks ‚Üí open Identity/Endpoint/Email workbook scoped to entities.</li>
                        <li>Response ‚Üí trigger playbooks (Logic Apps), isolate host (Defender), reset creds.</li>
                        <li>Close ‚Üí document timeline, root cause, actions, and lessons learned.</li>
                    </ol>
                </div>

                <h3>Investigation Flow (Portal)</h3>
                <ol>
                    <li>Open <em>Incidents</em> ‚Üí pick incident ‚Üí review <em>Entities</em> (accounts, hosts, IPs) and alert details.</li>
                    <li>Use <em>Evidence &amp; Response</em> to see correlated alerts and timeline; assign owner and severity.</li>
                    <li>Open <em>Investigation graph</em> ‚Üí expand entities to see related alerts, IPs, processes.</li>
                    <li>Click <em>View in Logs</em> to pivot into KQL with entity context; run targeted queries (below).</li>
                    <li>Open <em>Workbooks</em> (Identity/Endpoint/Email) for curated pivots; add filters for the incident entities.</li>
                    <li>Remediate: trigger playbooks (Logic Apps) or live response (Defender) if integrated; document in comments.</li>
                </ol>

                <h3>Quick KQL Playbook</h3>

                <h4>1) Coverage / Agent Health</h4>
                <div class="query-box">
<code>Heartbeat
| summarize last_beat=max(TimeGenerated) by Computer, OSType
| where last_beat < ago(1h)</code>
                </div>

                <h4>2) Failed ‚Üí Successful Sign-ins (Entra ID)</h4>
                <div class="query-box">
<code>let window = 15m;
SigninLogs
| where TimeGenerated > ago(24h)
| project TimeGenerated, UserPrincipalName, IPAddress, ResultType
| summarize fails = countif(ResultType != 0), success = countif(ResultType == 0)
    by bin(TimeGenerated, window), UserPrincipalName, IPAddress
| where fails > 5 and success > 0</code>
                </div>

                <h4>3) Suspicious PowerShell (Defender)</h4>
                <div class="query-box">
<code>DeviceProcessEvents
| where TimeGenerated > ago(1d)
| where ProcessCommandLine has_any ("-enc", "DownloadString", "Invoke-Expression")
| project TimeGenerated, DeviceName, AccountName, ProcessCommandLine</code>
                </div>

                <h4>4) Large Outbound Transfers (Firewall/Proxy)</h4>
                <div class="query-box">
<code>CommonSecurityLog
| where TimeGenerated > ago(24h) and DeviceAction == "ALLOW"
| extend BytesMB = toreal(SentBytes + ReceivedBytes) / 1024 / 1024
| where BytesMB > 500 and not(startswith(DestinationIP, "10.") or startswith(DestinationIP, "192.168."))
| summarize TotalMB = sum(BytesMB) by SourceIP, DestinationIP, DestinationPort
| order by TotalMB desc</code>
                </div>

                <h4>5) Rare Logon Locations (Entra ID)</h4>
                <div class="query-box">
<code>SigninLogs
| where TimeGenerated > ago(7d)
| summarize CountByLocation = count() by UserPrincipalName, Location = tostring(LocationDetails.country)
| join kind=inner (
    SigninLogs
    | where TimeGenerated > ago(1d)
    | summarize RecentCount = count() by UserPrincipalName, Location = tostring(LocationDetails.country)
) on UserPrincipalName, Location
| where RecentCount > 0 and CountByLocation < 3</code>
                </div>

                <div class="tip">
                    <strong>Playbook trigger:</strong> Use automation rules to run playbooks for High incidents or VIP entities.
                </div>

                <h3>Hunting &amp; Detections</h3>
                <ol>
                    <li>Go to <em>Hunting</em> ‚Üí run relevant queries (last 24h); add missing entity mappings.</li>
                    <li>Review results ‚Üí create incident for positives or link to existing incidents.</li>
                    <li>Save as scheduled analytics rule with suppression to prevent noise.</li>
                </ol>

                <h3>Log Onboarding Checklist</h3>
                <ul>
                    <li>Data connectors show <strong>Connected</strong> for M365, Defender, Entra ID, firewalls/proxies.</li>
                    <li>Enable analytics rules for new sources; map entities; tune thresholds.</li>
                    <li>Set retention/archive for critical tables; watch cost and ingestion caps.</li>
                    <li>Test with sample events (failed logins, EICAR, firewall allow) and confirm in <code>Logs</code>.</li>
                </ul>

                <h3>Incident Closure</h3>
                <ol>
                    <li>Summarize what happened, impact, root cause, and actions.</li>
                    <li>Tag MITRE tactics and add evidence links/screenshots.</li>
                    <li>Create follow-ups: rule/playbook/workbook updates to prevent recurrence.</li>
                </ol>
            </div>

            <!-- Linux Log Analysis Section -->
            <div id="linux" class="section">
                <h2>üêß Linux Log Analysis from Terminal</h2>

                <h3>Common Log File Locations</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Log File</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>/var/log/auth.log</code></td>
                                <td>Authentication logs (Debian/Ubuntu)</td>
                            </tr>
                            <tr>
                                <td><code>/var/log/secure</code></td>
                                <td>Authentication logs (RHEL/CentOS)</td>
                            </tr>
                            <tr>
                                <td><code>/var/log/syslog</code></td>
                                <td>System logs</td>
                            </tr>
                            <tr>
                                <td><code>/var/log/messages</code></td>
                                <td>General system messages</td>
                            </tr>
                            <tr>
                                <td><code>/var/log/kern.log</code></td>
                                <td>Kernel logs</td>
                            </tr>
                            <tr>
                                <td><code>/var/log/apache2/</code></td>
                                <td>Apache web server logs</td>
                            </tr>
                            <tr>
                                <td><code>/var/log/nginx/</code></td>
                                <td>Nginx web server logs</td>
                            </tr>
                            <tr>
                                <td><code>/var/log/mysql/</code></td>
                                <td>MySQL database logs</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="important">
                    <strong>Linux triage checklist:</strong>
                    <ol>
                        <li>Confirm time sync (<code>timedatectl</code>) and review recent auth failures.</li>
                        <li>Check persistence (crontab, systemd services, rc.local) and new users/groups.</li>
                        <li>Inspect running processes and network listeners; capture suspicious binaries (hash/upload to VT).</li>
                        <li>Review web/app logs around alert time; look for exploitation patterns.</li>
                        <li>Collect artifacts (logs, bash history, configs) before remediation.</li>
                    </ol>
                </div>

                <h3>Essential Commands for Log Analysis</h3>

                <h4>1. View Log Files</h4>
                <div class="description">
                    Basic commands to view logs:
                </div>
                <div class="query-box">
                    <code># View last 100 lines of auth.log
tail -n 100 /var/log/auth.log

# Follow log in real-time
tail -f /var/log/syslog

# View first 50 lines
head -n 50 /var/log/messages

# View entire log with pagination
less /var/log/syslog

# View compressed logs
zcat /var/log/syslog.1.gz | less</code>
                </div>

                <h4>2. Search and Filter Logs</h4>
                <div class="description">
                    Using grep to search logs:
                </div>
                <div class="query-box">
                    <code># Search for failed SSH logins
grep "Failed password" /var/log/auth.log

# Case-insensitive search
grep -i "error" /var/log/syslog

# Show line numbers
grep -n "authentication failure" /var/log/secure

# Show context (5 lines before and after)
grep -C 5 "kernel panic" /var/log/kern.log

# Search multiple files
grep "error" /var/log/*.log

# Recursive search in directory
grep -r "connection refused" /var/log/

# Invert match (exclude lines)
grep -v "DEBUG" /var/log/application.log

# Count occurrences
grep -c "Failed password" /var/log/auth.log</code>
                </div>

                <h4>3. Failed Login Attempts Analysis</h4>
                <div class="description">
                    Detect brute force attacks:
                </div>
                <div class="query-box">
                    <code># Count failed SSH login attempts by IP
grep "Failed password" /var/log/auth.log | awk '{print $(NF-3)}' | sort | uniq -c | sort -rn

# Show all failed login attempts with timestamps
grep "Failed password" /var/log/auth.log | awk '{print $1, $2, $3, $(NF-5), $(NF-3)}'

# Failed logins for specific user
grep "Failed password for invalid user" /var/log/auth.log | grep "username"

# Successful logins after failures
grep -E "(Failed password|Accepted password)" /var/log/auth.log | grep "192.168.1.100"</code>
                </div>

                <h4>4. User Activity Monitoring</h4>
                <div class="description">
                    Track user sessions and commands:
                </div>
                <div class="query-box">
                    <code># Show current logged-in users
who

# Show last logged-in users
last -n 20

# Show failed login attempts
lastb -n 20

# Show user login history
last username

# Show all sudo commands
grep "sudo" /var/log/auth.log | grep "COMMAND"

# Show user command history
cat /home/username/.bash_history</code>
                </div>

                <h4>5. Network Connection Analysis</h4>
                <div class="description">
                    Monitor network activities:
                </div>
                <div class="query-box">
                    <code># Show established connections
netstat -tupn | grep ESTABLISHED

# Show listening ports
ss -tlnp

# Show connections by IP
netstat -an | grep "192.168.1.100"

# Monitor connections in real-time
watch -n 1 'netstat -tupn | grep ESTABLISHED'

# Show firewall logs (iptables)
grep "DPT=" /var/log/syslog | tail -50</code>
                </div>

                <h4>6. Process Monitoring</h4>
                <div class="description">
                    Track running processes:
                </div>
                <div class="query-box">
                    <code># Show all processes
ps aux

# Search for specific process
ps aux | grep nginx

# Show process tree
pstree -p

# Monitor processes in real-time
top -c

# Better process monitor
htop

# Show processes by user
ps -u username</code>
                </div>

                <h4>7. Analyze Web Server Logs</h4>
                <div class="description">
                    Apache/Nginx log analysis:
                </div>
                <div class="query-box">
                    <code># Top 10 IP addresses accessing site
awk '{print $1}' /var/log/apache2/access.log | sort | uniq -c | sort -rn | head -10

# Show 404 errors
grep "404" /var/log/apache2/access.log

# Show POST requests
grep "POST" /var/log/apache2/access.log

# Analyze user agents
awk -F'"' '{print $6}' /var/log/apache2/access.log | sort | uniq -c | sort -rn

# Find SQL injection attempts
grep -E "(union.*select|drop.*table|exec.*\()" /var/log/apache2/access.log

# Show requests to specific URL
grep "/admin" /var/log/nginx/access.log

# Count requests by hour
awk '{print $4}' /var/log/apache2/access.log | cut -c 14-15 | sort | uniq -c</code>
                </div>

                <h4>8. System Resource Analysis</h4>
                <div class="description">
                    Monitor system performance:
                </div>
                <div class="query-box">
                    <code># Check disk space
df -h

# Show disk usage by directory
du -sh /var/* | sort -rh | head -10

# Monitor memory usage
free -h

# Show largest log files
find /var/log -type f -exec ls -lh {} \; | sort -k5 -rh | head -10

# Monitor I/O statistics
iostat -x 5</code>
                </div>

                <h4>9. Time-Based Log Analysis</h4>
                <div class="description">
                    Filter logs by date and time:
                </div>
                <div class="query-box">
                    <code># Show logs from specific date
grep "Jan 26" /var/log/syslog

# Show logs between time range
sed -n '/09:00:00/,/17:00:00/p' /var/log/syslog

# Show logs from last hour using awk
awk -v date="$(date --date='1 hour ago' '+%b %_d %H')" '$0 ~ date' /var/log/syslog

# Show today's auth logs
grep "$(date '+%b %e')" /var/log/auth.log</code>
                </div>

                <h4>10. Advanced Log Analysis with awk</h4>
                <div class="description">
                    Complex pattern extraction:
                </div>
                <div class="query-box">
                    <code># Extract specific fields from logs
awk '/Failed password/ {print $1, $2, $3, $11}' /var/log/auth.log

# Calculate statistics
awk '/error/ {count++} END {print "Total errors:", count}' /var/log/syslog

# Filter by multiple conditions
awk '$9 == 404 && $7 ~ /admin/ {print $1, $7}' /var/log/apache2/access.log

# Sum bandwidth usage
awk '{sum+=$10} END {print "Total bytes:", sum}' /var/log/nginx/access.log</code>
                </div>

                <h4>11. Log Rotation and Management</h4>
                <div class="description">
                    Manage log files:
                </div>
                <div class="query-box">
                    <code># View logrotate configuration
cat /etc/logrotate.conf

# Manually rotate logs
logrotate -f /etc/logrotate.conf

# Check log sizes
ls -lh /var/log/

# Archive old logs
tar -czf logs_backup_$(date +%Y%m%d).tar.gz /var/log/*.log

# Clear log file (keep file)
truncate -s 0 /var/log/application.log</code>
                </div>

                <h4>12. Journalctl (systemd logs)</h4>
                <div class="description">
                    Modern systemd log analysis:
                </div>
                <div class="query-box">
                    <code># View all system logs
journalctl

# Follow logs in real-time
journalctl -f

# Show logs for specific service
journalctl -u ssh.service

# Show logs since boot
journalctl -b

# Show logs for time range
journalctl --since "2026-01-26 09:00:00" --until "2026-01-26 17:00:00"

# Show only errors
journalctl -p err

# Show kernel messages
journalctl -k

# Show logs with priority levels
journalctl -p warning..err</code>
                </div>

                <div class="tip">
                    <strong>üí° Linux Log Analysis Tips:</strong>
                    <ul>
                        <li>Always use sudo/root for accessing system logs</li>
                        <li>Combine commands with pipes for powerful analysis</li>
                        <li>Use <code>watch</code> command for real-time monitoring</li>
                        <li>Regular log rotation prevents disk space issues</li>
                        <li>Create aliases for frequently used log analysis commands</li>
                        <li>Use <code>rsyslog</code> or <code>syslog-ng</code> for centralized logging</li>
                    </ul>
                </div>
            </div>

            <!-- Best Practices Section -->
            <div id="best-practices" class="section">
                <h2>‚úÖ Best Practices for SOC Analysts</h2>

                <h3>Investigation Methodology</h3>
                <ol>
                    <li><strong>Initial Triage:</strong> Quickly assess the severity and scope of the incident</li>
                    <li><strong>Data Collection:</strong> Gather relevant logs from all affected systems</li>
                    <li><strong>Timeline Creation:</strong> Build a chronological timeline of events</li>
                    <li><strong>Correlation:</strong> Correlate events across multiple data sources</li>
                    <li><strong>Root Cause Analysis:</strong> Identify the initial attack vector</li>
                    <li><strong>Containment:</strong> Take action to prevent further damage</li>
                    <li><strong>Documentation:</strong> Document all findings and actions taken</li>
                    <li><strong>Post-Incident Review:</strong> Review and improve detection capabilities</li>
                </ol>

                <h3>Query Optimization Tips</h3>
                <ul>
                    <li>Start with specific time ranges to reduce search scope</li>
                    <li>Use indexed fields for faster searches</li>
                    <li>Limit results with head/limit commands during testing</li>
                    <li>Use subsearches only when necessary</li>
                    <li>Leverage statistical commands (stats, chart, timechart)</li>
                    <li>Create lookup tables for threat intelligence</li>
                </ul>

                <h3>Alert Creation Guidelines</h3>
                <div class="important">
                    <strong>‚ö†Ô∏è Important:</strong> Poorly configured alerts lead to alert fatigue. Focus on high-fidelity detections.
                </div>
                <ul>
                    <li>Define clear alert criteria based on known attack patterns</li>
                    <li>Set appropriate thresholds to minimize false positives</li>
                    <li>Include relevant context in alert notifications</li>
                    <li>Regularly review and tune alert rules</li>
                    <li>Use alert suppression for known maintenance windows</li>
                    <li>Implement alert escalation procedures</li>
                </ul>

                <h3>Log Retention and Management</h3>
                <ul>
                    <li>Follow organizational and regulatory retention requirements</li>
                    <li>Implement hot/warm/cold data tiering strategies</li>
                    <li>Use compression for archived logs</li>
                    <li>Regularly test log restoration procedures</li>
                    <li>Monitor log collection pipeline health</li>
                </ul>

                <h3>Continuous Improvement</h3>
                <ul>
                    <li>Stay updated with latest threat intelligence</li>
                    <li>Regularly review and update detection rules</li>
                    <li>Participate in threat hunting exercises</li>
                    <li>Share knowledge with team members</li>
                    <li>Learn from past incidents to improve detection</li>
                    <li>Practice query writing and log analysis skills</li>
                </ul>

                <h3>Essential Tools and Resources</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Tool/Resource</th>
                                <th>Purpose</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>MITRE ATT&amp;CK Framework</td>
                                <td>Threat intelligence and attack patterns</td>
                            </tr>
                            <tr>
                                <td>Sigma Rules</td>
                                <td>Generic signature format for SIEM systems</td>
                            </tr>
                            <tr>
                                <td>CyberChef</td>
                                <td>Data decoding and analysis</td>
                            </tr>
                            <tr>
                                <td>VirusTotal</td>
                                <td>File and URL reputation checking</td>
                            </tr>
                            <tr>
                                <td>AbuseIPDB</td>
                                <td>IP reputation database</td>
                            </tr>
                            <tr>
                                <td>AlienVault OTX</td>
                                <td>Open threat intelligence platform</td>
                            </tr>
                            <tr>
                                <td>Regex101</td>
                                <td>Regular expression testing and debugging</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h3>Common Indicators of Compromise (IOCs)</h3>
                <ul>
                    <li><strong>Authentication:</strong> Multiple failed logins, logins from unusual locations, logins outside business hours</li>
                    <li><strong>Network:</strong> Unusual outbound traffic, connections to known malicious IPs, DNS tunneling</li>
                    <li><strong>Process:</strong> Suspicious process names, encoded PowerShell commands, privilege escalation</li>
                    <li><strong>File System:</strong> Unauthorized file modifications, creation of suspicious files, changes to system files</li>
                    <li><strong>Web:</strong> SQL injection attempts, directory traversal, unusual user agents, brute force attacks</li>
                </ul>

                <div class="tip">
                    <strong>üí° Pro Tip:</strong> Create a personal cheatsheet with queries specific to your environment and 
                    regularly used commands. This will significantly speed up your investigation process.
                </div>
            </div>
            </div>
        </div>

        <div class="footer">
            <p>&copy; 2026 SOC Analyst Guide | Transport and Telecommunication Institute - Riga, Latvia</p>
            <p>Created by: st93642@students.tsi.lv | <a href="https://tsi.lv" style="color: #3498db;">https://tsi.lv</a></p>
        </div>
    </div>
</body>
</html>
